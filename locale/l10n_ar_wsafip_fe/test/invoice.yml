#
#       Create an invoice from Resp Inscr to Resp Inscr.
#
- Create a simple invoice type B
- !record {model: account.invoice, id: inv_ri2ri}:
    company_id: com_ivari
    journal_id: !ref {model: account.journal, search: "[('code','=','FVB0001'), ('company_id.name','=','Coop. Trab. Moldeo Interactive Ltda.')]"}
    period_id:  !ref {model: account.period, search: "[('company_id.name','=','Coop. Trab. Moldeo Interactive Ltda.')]"}
    account_id: !ref {model: account.account, search: "[('code','=','113010'), ('company_id.name','=','Coop. Trab. Moldeo Interactive Ltda.')]"}
    partner_id: !ref {model: res.partner, search: "[('name','=','Cristian S. Rocha')]"}
    address_contact_id: !ref {model: res.partner.address, search: "[('partner_id.name','=','Cristian S. Rocha')]"}
    address_invoice_id: !ref {model: res.partner.address, search: "[('partner_id.name','=','Cristian S. Rocha')]"}
    invoice_line:
      - account_id: !ref {model: account.account, search: "[('code','=','411000'), ('company_id.name','=','Coop. Trab. Moldeo Interactive Ltda.')]"}
        name: '[PC3] Medium PC'
        price_unit: 900.0
        quantity: 10.0
        product_id: product.product_product_pc3
        uos_id: product.product_uom_unit
        invoice_line_tax_id: !ref {model: account.tax, search: "[('name','=','IVA Ventas 21%'),('company_id.name','=','Coop. Trab. Moldeo Interactive Ltda.')]"}

- Compute amount
- !python {model: account.invoice}: |
    inv_id = [ref('inv_ri2ri')]
    self.view_init(cr, uid, inv_id, {})
    self.button_compute(cr, uid, inv_id)


- Check invoice
- !python {model: account.invoice}: |
    # Workflow standard
    self.action_date_assign(cr, uid, [ref('inv_ri2ri')])
    self.action_move_create(cr, uid, [ref('inv_ri2ri')]) # Todav√≠a no lo valido y voy a crear los movimientos? Es raro.
    self.action_number(cr, uid, [ref('inv_ri2ri')])

- Check CAE invoice number
- !assert {model: account.invoice, id: inv_ri2ri, string: CAE has been assigned}:
    - afip_cae != ''
    - afip_batch_number == 1
    - afip_result == 'A'
    - afip_error_id.description == 'Sin errores'

